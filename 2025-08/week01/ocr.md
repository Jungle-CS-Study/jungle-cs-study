# PDF 파싱의 다음 단계: OCR 개요

## 들어가며

지난 글 "PDF 파서 완벽 가이드"에서는 PDF의 내부 구조를 파헤치며 텍스트를 추출하는 원리를 알아봤습니다. 하지만 개발 현장에서는 더 까다로운 문제를 마주합니다. 바로 PDF 파서를 실행했는데 아무 텍스트도 추출되지 않는 경우입니다. 파일을 열어보면 분명히 글자들이 보이는데 말이죠.

이런 현상은 PDF가 텍스트 정보 없이, 페이지 전체가 하나의 큰 이미지나 벡터 그래픽으로 이루어져 있을 때 발생합니다.

이처럼 컴퓨터가 읽을 수 없는 이미지 속 글자를 '읽을 수 있는' 텍스트 데이터로 변환해주는 기술이 바로 **OCR(Optical Character Recognition, 광학 문자 인식)**입니다. 

이번 글에서는 PDF OCR이 무엇이며, 어떤 원리로 동작하는지, 그리고 OCR 최적화 방법에는 무엇이 있는지 개괄적으로 살펴보게씃ㅂ니다.

## 1. 왜 OCR이 필요한가? (텍스트 기반 vs. 이미지 기반)

OCR의 필요성을 이해하려면 먼저 두 종류의 PDF를 구분해야 합니다.

### 텍스트 기반 PDF (Digitally-created PDF)

MS 워드나 한컴오피스에서 'PDF로 저장'하여 만든 파일입니다.

- 내부적으로 텍스트 데이터와 폰트 정보가 살아있어 마우스로 텍스트를 선택하고 복사할 수 있습니다.
- 일반적인 PDF 파서로 텍스트를 추출할 수 있습니다.

### 이미지/벡터 기반 PDF (Image-based PDF)

**종이 문서를 스캔한 경우**: 스캐너로 만든 PDF는 페이지 전체가 하나의 큰 사진(.jpg)과 같습니다. 내부에는 글자 정보 없이 픽셀(pixel) 데이터만 존재합니다.

**디자인 툴에서 변환한 경우**: Figma, Adobe Illustrator 같은 툴에서 만든 디자인 요소를 PDF로 내보낼 때, 텍스트가 포함된 객체라도 폰트 정보가 없는 벡터 그래픽(drawing commands)이나 래스터 이미지(pixels)로 변환되는 경우가 많습니다. 겉보기엔 깨끗한 텍스트지만, 실제로는 '글자 모양의 그림'일 뿐입니다.

이런 PDF들은 내부적으로 글자에 대한 정보가 전혀 없기 때문에 마우스로 텍스트를 선택하거나 복사할 수 없으며, 일반 파서는 이 파일을 '글자가 없는 빈 페이지'로 인식합니다. 여기서 OCR이 필요합니다.

## 2. PDF OCR은 어떻게 동작하는가? (처리 파이프라인)

PDF OCR은 단순히 이미지를 텍스트로 '짠'하고 변환하는 마법이 아닙니다. 여러 단계로 이루어진 **처리 파이프라인(Pipeline)**을 거칩니다.

### 이미지/페이지 렌더링 (Image Extraction / Rendering)

OCR을 위해서는 모든 PDF 내용을 픽셀 기반 이미지로 변환해야 합니다. 이는 **OCR 엔진들이 픽셀 데이터를 입력으로 받도록 설계**되어 있기 때문입니다.

스캔된 PDF의 경우:

- **이미지 객체(Image Object)**를 직접 추출할 수 있습니다. 여기서 이미지 객체란, PDF 파일 내부에 .jpg나 .png 파일처럼 이미지의 픽셀 데이터를 압축해서 담고 있는 데이터 덩어리(stream)를 말합니다.
- 하지만 실무에서는 해상도 통일과 전처리 최적화를 위해 페이지 렌더링을 사용하는 경우가 많습니다.

벡터 기반 PDF의 경우:

- Figma, Adobe Illustrator에서 텍스트가 아웃라인화되어 벡터 그래픽(패스, drawing commands)으로 저장된 경우, 페이지 전체를 고해상도 이미지로 렌더링하는 과정이 필요합니다.

즉, **일반 PDF 파서로 텍스트 추출이 안 되는 PDF라면, 그 이유가 무엇이든 이미지 변환 과정이 필수적**입니다.

### 전처리 (Preprocessing)

OCR의 정확도를 높이기 위한 가장 중요한 단계입니다.

- **기울기 보정 (Skew Correction)**: 비뚤게 스캔된 이미지를 바로잡습니다.
- **노이즈 제거 (Noise Removal)**: 스캔 과정에서 생긴 불필요한 점이나 얼룩을 제거합니다.
- **이진화 (Binarization)**: 이미지를 선명한 흑과 백으로 구분하여 글자를 명확하게 만듭니다.

### 레이아웃 분석 (Layout Analysis)

- 이미지 내에서 글자, 그림, 표 등이 어디에 위치하는지 파악합니다.
- 단락은 어디서 나뉘는지, 다단(Multi-column) 구성인지 등을 분석하여 텍스트의 논리적인 순서를 예측합니다.

### 문자 인식 (Character Recognition)

분석된 영역의 픽셀 패턴을 보고 문자를 식별하는 핵심 단계입니다. 이 과정은 과거와 현재의 방식에 근본적인 차이가 있습니다.

#### 과거 방식: 규칙 기반 접근법

**패턴 매칭**: 미리 저장된 글자 모양(템플릿)과 이미지의 글자 부분을 하나하나 비교하는 방식이었습니다.

**특징점 분석**: 'ㄱ'은 꺾인 선 2개, 'ㅏ'는 긴 세로선과 짧은 가로선 1개 같은 글자의 구조적 특징점을 사람이 직접 정의하고 분석했습니다.

**한계**: 빠르지만, 정해진 폰트나 크기가 아니면 인식률이 급격히 떨어지는 단점이 있었습니다.

#### 현재 방식: 딥러닝 혁명

현대 OCR의 핵심은 **인공신경망이 직접 글자의 시각적 패턴을 학습**한다는 점입니다.

**1. CNN (Convolutional Neural Networks) - 시각적 특징 추출**

사람의 시각 피질을 모방한 CNN이 이미지에서 글자의 핵심 특징을 자동으로 찾아냅니다.
- 선분, 곡선, 교차점 등의 기본 요소부터 시작해서
- 점진적으로 글자의 부분적 모양, 전체 모양까지 계층적으로 학습합니다.
- 사람이 특징을 정의할 필요 없이, 수백만 개의 글자 이미지를 보고 스스로 패턴을 발견합니다.

**2. RNN/LSTM - 문맥과 시퀀스 이해**

글자는 혼자 존재하지 않고 단어, 문장의 일부입니다. RNN 계열 모델은:
- 앞뒤 글자의 문맥을 고려해서 애매한 글자를 정확히 판별합니다.
- 예: "안녕하세○" → 문맥상 마지막 글자는 "요"일 가능성이 높음

**3. CRNN (CNN + RNN) - 현대 OCR의 표준 구조**

```
이미지 → CNN(특징 추출) → RNN(시퀀스 처리) → 텍스트
```

**4. Transformer 기반 OCR - 최신 기술**

최근에는 GPT, BERT와 같은 Transformer 구조를 OCR에 적용한 모델들이 등장했습니다:
- 전체 문서를 한 번에 이해하는 능력
- 복잡한 레이아웃에서도 논리적 읽기 순서 파악
- 다국어 문서의 언어별 영역 자동 식별

#### 구체적인 성능 차이

현대 딥러닝 기반 OCR의 강점:
- **다양한 폰트 대응**: 학습하지 않은 새로운 폰트도 처리 가능
- **변형에 강함**: 약간의 기울어짐, 노이즈, 해상도 변화에도 안정적
- **문맥 이해**: "rn"과 "m"을 구분하는 등 문맥을 고려한 판별
- **다국어 지원**: 하나의 모델로 여러 언어 동시 처리 가능

## 3. PDF OCR 사용 시 도전 과제 및 고려사항

OCR 기술은 매우 발전했지만, 여전히 만능은 아닙니다. 실제 개발에 적용할 때는 다음 사항들을 반드시 고려해야 합니다.

### 정확도 (Accuracy)

현대 OCR은 좋은 조건에서 99% 이상의 정확도를 달성할 수 있지만, 스캔 품질(해상도, 밝기), 문서의 레이아웃 복잡성, 글자의 폰트나 크기, 손글씨 여부에 따라 결과가 크게 달라집니다. 특히 한글처럼 복잡한 문자는 영어보다 인식 난이도가 높습니다.

### 성능 (Performance)

OCR은 이미지 처리와 머신러닝 모델 추론을 포함하기 때문에 CPU와 메모리 소모가 매우 큰 작업입니다. 단순 텍스트 파싱에 비해 수십, 수백 배 이상의 시간이 걸릴 수 있어, 실시간 대량 처리가 필요할 경우 아키텍처 설계에 신중해야 합니다.

### 비용 (Cost)

- Google Cloud Vision, NAVER CLOVA OCR, Azure AI Vision과 같은 고품질 상용 OCR 서비스는 사용량에 따라 비용이 부과됩니다.
- Tesseract와 같은 오픈소스 라이브러리는 무료지만, 만족스러운 정확도를 얻기 위해 직접 모델을 튜닝하거나 복잡한 전처리 로직을 구현해야 하는 수고가 따릅니다.

### 언어 지원 (Language Support)

사용하려는 OCR 엔진이 처리하고자 하는 문서의 언어를 지원하는지 반드시 확인해야 합니다. 영문 전용 OCR 모델로 한글 문서를 처리하면 전혀 엉뚱한 결과를 얻게 됩니다.

## 4. 성공적인 PDF OCR을 위한 실용적인 팁

### "Garbage In, Garbage Out" (나쁜 입력은 나쁜 결과를 낳는다)

가장 중요한 원칙입니다. 가능한 한 고품질의 원본 이미지를 확보하세요. 문서 유형에 따른 권장 해상도:
- 일반 텍스트 문서: 200-300 DPI
- 작은 글씨나 복잡한 문서: 400-600 DPI
- 손글씨나 특수 문서: 600 DPI 이상

### 스마트한 결합 방식 (Hybrid Approach)

모든 PDF에 무조건 OCR을 실행하는 것은 비효율적입니다.

1. **1단계**: 먼저 일반 PDF 파서로 텍스트 추출을 시도합니다.
2. **2단계**: 만약 추출된 텍스트가 거의 없다면, 그때 이미지/벡터 기반 PDF로 판단하고 OCR 파이프라인을 실행합니다. 

이 방식은 비용과 시스템 리소스를 크게 절약할 수 있습니다.

### 목적에 맞는 도구 선택

- 높은 정확도가 최우선이고 비용을 감당할 수 있다면 검증된 상용 클라우드 OCR 서비스를 사용하는 것이 좋습니다.
- 비용이 중요하고 특정 도메인에 최적화된 모델이 필요하다면 Tesseract와 같은 오픈소스를 기반으로 직접 개발하는 것을 고려할 수 있습니다.
