## TCP/IP 스터디 자료

이 자료는 IP 주소의 기본 개념부터 TCP의 신뢰성 있는 데이터 전송과 혼잡 제어 메커니즘을 예시를 들어 하나로 연결하여 정리한 것임.

---

### **1부: 주소 체계와 배송 담당자 (IP)**

인터넷 통신을 하려면 먼저 데이터를 어디로 보낼지 알아야 함. 그 주소 체계와 배송을 담당하는 것이 바로 IP임.

#### **IP 주소의 구성: 인터넷 세상의 주소**

IP 주소는 인터넷 세상의 집 주소와 같음. 이 주소는 크게 **네트워크 영역**과 **호스트 영역**으로 나뉘며, 이 둘을 구분하는 것이 바로 **서브넷 마스크**임.

* **네트워크 영역 (Network Area)**
    * 특정 동네나 아파트 단지를 식별하는 주소 부분임. 라우터는 이 주소를 보고 "아, 이 데이터는 강남구로 보내야겠군" 하고 경로를 결정함. 예를 들어 `192.168.1.0` 네트워크는 `192.168.1` 부분이 이 영역에 해당함.

* **호스트 영역 (Host Area)**
    * 동네 안에서 특정 집(컴퓨터)을 찾아가는 상세 주소 부분임. 같은 네트워크(동네) 안의 장치들은 모두 호스트 주소만 다름. 예를 들어 `192.168.1.10`과 `192.168.1.20`은 같은 동네에 사는 서로 다른 집임.

* **서브넷 마스크 (Subnet Mask)**
    * IP 주소에서 어디까지가 동네 주소(네트워크)이고 어디부터가 상세 주소(호스트)인지 구분해주는 기준표임. 2진수로 표현했을 때 **`1`로 채워진 부분이 네트워크 영역**, `0`인 부분이 호스트 영역을 의미함.
    * **예시**: 서브넷 마스크 `255.255.255.0`은 앞에서부터 24비트(3칸)까지가 네트워크 영역이라고 알려주는 것임.

* **와일드카드 마스크 (Wildcard Mask)**
    * 서브넷 마스크와 정반대의 개념으로, 주로 접근 제어(ACL)에서 사용됨. 2진수에서 **`0`은 "반드시 일치해야 함(검사 대상)"**, **`1`은 "신경 쓰지 않음(무시)"**을 의미함. `192.168.1.0`에 와일드카드 마스크 `0.0.0.255`를 적용하면, `192.168.1`까지는 똑같고 마지막은 아무거나(`0`~`255`) 와도 된다는 뜻임.

#### **IP의 역할: 무심한 택배 기사**

* IP의 유일한 임무는 데이터 조각(**패킷**)을 **출발지 IP 주소**에서 **목적지 IP 주소**까지 전달하는 것임.
* **여기서 중요한 점**: IP는 딱 배송만 책임짐. 이 패킷이 중간에 사라지든, 순서가 뒤바뀌어 도착하든, 깨져서 도착하든 **전혀 신경 쓰지 않음**. (비신뢰성)

---

### **2부: 신뢰를 책임지는 포장 전문가 (TCP)**

IP라는 무심한 택배 기사를 믿을 수 없기에, 데이터 전송의 처음부터 끝까지를 책임지는 꼼꼼한 포장 전문가 TCP가 필요함. TCP는 IP 위에서 동작하며 신뢰성을 보장함.

#### **TCP의 동작 원리: 신뢰를 쌓는 대화법**

TCP는 데이터를 그냥 던지는 게 아니라, 상대방과 계속 대화하며 "잘 받았니?", "나 이제 보낸다?"라고 확인하는 신뢰성 끝판왕 프로토콜임. 이 과정은 크게 세 단계로 나뉨.

**1단계: 연결 수립 (3-Way Handshake)**
본격적인 대화 전에 서로 통화 준비가 됐는지 확인하는 과정임. 택배를 보내기 전에 받는 사람에게 미리 전화해서 "지금 택배 보낼 건데 받을 준비됐나요?"라고 확인하는 것과 같음.

1.  **SYN**: 클라이언트가 서버에게 "나랑 통화할래?"라고 연결 요청을 보냄.
2.  **SYN-ACK**: 서버가 "어, 좋아! 나도 준비됐어. 너도 준비됐지?"라고 응답함.
3.  **ACK**: 클라이언트가 "응! 나도 준비 완벽해! 이제 시작하자!"라고 최종 확인을 보냄.

**2단계: 데이터 전송 (포장, 번호표 부착, 배송 확인)**
연결이 되면, 큰 데이터를 작은 조각(**세그먼트**)으로 쪼개서 보내고, 잘 도착했는지 일일이 확인함.

* **순서 보장**: 각 조각에 번호표(Sequence Number)를 붙여서 보냄. 받는 쪽은 이 번호표를 보고 순서대로 다시 조립함.
* **응답 확인**: 받는 쪽은 데이터를 받을 때마다 "나 몇 번까지 잘 받았어!"라는 응답(Acknowledgement)을 보냄. 만약 보낸 쪽에서 일정 시간 응답이 없으면, "아, 배송 사고가 났나 보다"하고 해당 조각을 **재전송**해줌.

**3단계: 연결 종료 (4-Way Handshake)**
데이터를 다 보내고 "이제 그만 통화하자"고 예의 바르게 헤어지는 과정임.

1.  **FIN**: 클라이언트가 "나 이제 할 말 다했어. 끊을게"라고 말함.
2.  **ACK**: 서버가 "알겠어. 잠시만, 나는 아직 할 말 남았을 수 있어"라고 답함.
3.  **FIN**: 서버도 할 말을 다 마치면, "나도 이제 끝났어. 진짜 끊자"라고 말함.
4.  **ACK**: 클라이언트가 "알겠어!"라고 마지막 인사를 하고 통화를 완전히 종료함.

---

### **3부: 똑똑한 교통 경찰 (TCP 혼잡 제어)**

TCP는 단순히 데이터를 안정적으로 보낼 뿐만 아니라, 인터넷이라는 공용 도로가 막히지 않도록 스스로 속도를 조절하는 똑똑한 교통 경찰 역할도 함.

#### **혼잡 제어의 기본 철학: AIMD**
TCP는 기본적으로 **"조심스럽게 차를 늘리다(Additive Increase), 사고 나면 확 줄이는(Multiplicative Decrease)"** 철학을 가지고 있음.

* **Additive Increase (합 증가)**: 도로에 차가 별로 없는 것 같으면, 아주 조금씩(1대씩) 차를 더 내보내 보는 것임.
* **Multiplicative Decrease (곱 감소)**: 차가 꽉 막히는 상황(패킷 유실)이 발생하면, 내보내던 차의 **절반을 확 빼버리는 것**임.

#### **혼잡 제어를 위한 4가지 핵심 기술**
TCP는 AIMD라는 기본 철학을 바탕으로, 상황에 따라 다음 4가지 기술을 조합해서 사용함.

**1. 슬로우 스타트 (Slow Start)**
* **언제?** 통신을 맨 처음 시작할 때.
* **어떻게?** 처음에는 아주 조금만 보내보고, **ACK를 받을 때마다 전송량을 2배씩 폭발적으로 늘림.** (1→2→4→8...)
* **왜?** 네트워크가 얼마나 감당할 수 있는지 최대한 빨리 파악하기 위함임.

**2. 혼잡 회피 (Congestion Avoidance)**
* **언제?** 슬로우 스타트로 속도를 올리다가 정해둔 **임계점을 넘었을 때**부터.
* **어떻게?** 이제부터는 2배씩 늘리는 위험한 짓은 안 하고, **아주 조금씩, 1씩만 전송량을 늘림.**
* **왜?** 네트워크의 한계점에 가까워졌다고 보고, 혼잡이 발생하는 것을 미리 피하기 위함임.

**3. 빠른 재전송 (Fast Retransmit)**
* **언제?** 데이터가 중간에 하나 사라졌을(유실) 때.
* **어떻게?** **동일한 ACK 신호가 3번 연속으로 도착**하면, 타임아웃까지 기다리지 않고 즉시 해당 데이터를 다시 보내줌.
* **왜?** 불필요한 대기 시간을 없애고 훨씬 빠르게 문제를 해결하기 위함임.

**4. 빠른 회복 (Fast Recovery)**
* **언제?** '빠른 재전송'이 동작한 직후.
* **어떻게?** 전송량을 절반으로 줄이긴 하지만, 1부터 다시 시작하지 않고 **'혼잡 회피' 단계로 넘어가** 전송량을 다시 늘리기 시작함.
* **왜?** 네트워크가 아직 쓸만하다고 판단하고, 최대한 빠르게 정상 속도로 회복하기 위함임.

