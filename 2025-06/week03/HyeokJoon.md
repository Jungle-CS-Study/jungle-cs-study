# Netflix는 어떤 전략을 사용할까? – 부하 테스트 대응 전략 분석

## 1. 부하 테스트의 기본 대응 방법 (정석적인 방법)

부하 테스트의 목적은 시스템이 일정 수준 이상의 트래픽을 수용할 수 있는지를 사전에 확인하고, 병목을 제거하여 안정성을 확보하는 것이다. 일반적으로 사용하는 정석적인 대응 방법은 다음과 같다:

* **수직적 확장 (Scale-up)**: CPU, 메모리, 디스크 등의 성능이 더 좋은 서버로 교체
* **수평적 확장 (Scale-out)**: 서버 인스턴스를 여러 대로 분산 배치하여 부하 분산
* **캐시 도입**: Redis, CDN 등으로 정적 또는 반복되는 요청에 대한 처리 속도 향상
* **쿼리 및 코드 최적화**: 느린 DB 쿼리 튜닝, 불필요한 연산 제거, 인덱싱
* **비동기 처리 및 메시지 큐 도입**: 사용자 응답과 후처리를 분리해 성능 개선 (응답 속도 단축)
* **로깅 및 모니터링 강화**: 장애 감지 및 병목 식별 도구(AWS CloudWatch, Datadog 등) 도입

대부분의 웹 서비스에 적용 되어있는 기본적인 대응 전략이다.

---

## 2. Netflix의 부하 대응 전략 – 차별화된 접근

Netflix는 전 세계 수억 명의 사용자를 대상으로 고화질 스트리밍 서비스를 제공하는데 엄청난 안정성을 가지고 있다.  
Netfilx에서는 기본 전략을 넘어 고도화된 전략들을 통해 업계 최고의 성능을 달성할 수 있었다고 한다.
[관련 자료](https://www.p99conf.io/2023/09/28/20-low-latency-engineering-case-studies-netflix-twitter-tiktok-square-uber-more/?utm_source=chatgpt.com)

### 2.1 Load Shedding (선택적 요청 차단)

* **서비스 우선순위 분류**: 사용자의 "직접 요청"(영화 재생 등)과 "비핵심 요청"(추천, 사전 요청)을 구분
* **실시간 부하에 따라 비핵심 요청 차단**: 서버 부하가 일정 임계치를 넘으면 우선순위가 낮은 요청부터 차단하거나 지연 처리
* **효과**: 트래픽이 급증해도 핵심 기능은 안정적으로 작동 → 사용자 체감 성능 유지
* [프리 패치 요청이 50% 이상 차단되어도 사용자 요청의 가용성은 99% 유지](https://netflixtechblog.com/enhancing-netflix-reliability-with-service-level-prioritized-load-shedding-e735e6ce8f7d)

### 2.2 EVCache: 고성능 캐시 계층 (Ephemeral Volatile)

* **Memcached 기반 자체 캐시 시스템**
* **맞춤 콘텐츠, 사용 이력, 트렌드 콘텐츠 등 미리 계산해 저장**
* **네트워크 단에서 빠르게 응답 가능**
* **효과**: DB 부하를 수천 배 줄이고, 글로벌 사용자 요청의 80% 이상을 캐시에서 해결

### 2.3 Open Connect – 자체 CDN 구축

* **ISP에 자체 캐시 서버(OCA) 설치** → 사용자 가까운 곳에서 콘텐츠 제공
* **네트워크 레이턴시, 백본 트래픽 감소**
* **대규모 부하 상황에서도 안정적인 스트리밍 품질 유지**
```
1. 사용자가 Netflix 앱에서 영화 재생 요청
예) 서울에서 SKB 인터넷을 통해 Netflix 접속

2. DNS를 통해 요청 식별 및 라우팅
Netflix는 Open Connect 전용 도메인 시스템을 사용

3. 이 도메인을 Netflix 자체 DNS 인프라 (BGP + Geo DNS)가 분석해서,
예) 이 사용자가 SKB망 안에 있는지 확인 : 도메인 → SKB 내부 OCA IP 주소로 변환
```

### 2.4 Chaos Engineering

* **의도적인 장애 투입으로 시스템의 복원력 점검**
* 대표 도구: **Chaos Monkey**, **Simian Army**
* "만약 이 서버가 죽는다면?"에 대한 시뮬레이션과 대응 체계 확보
* **효과**: 예측 불가능한 상황에서도 자동 복구 및 빠른 격리 대응 가능

### 2.5 마이크로아키텍처 수준 튜닝

하드웨어 수준의 튜닝을 통해 각각의 인스턴스의 성능을 높임
* **PerfSpect, Intel VTune 등 사용해 CPU 단위 분석**
* JVM 내부 메모리 관리, 스레드 스케줄링 최적화
* 캐시 미스율, context switching, GC 정지 시간 등을 최소화
* 효과: 인스턴스당 성능 효율 3배 이상 향상, 리소스 비용 절감

---

## 3. 종합 정리

| 전략                 | 설명             | Netflix에서의 활용                      |
| ------------------ | -------------- | ---------------------------------- |
| Load Shedding      | 비핵심 요청을 실시간 차단 | 프리패치 요청 최대 80% 차단, 직접 요청은 99.4% 유지 |
| EVCache            | 고속 캐시 저장소      | DB 부하 최소화, 사용자 요청 처리 속도 향상         |
| CDN (Open Connect) | 사용자 근접 캐시 서버   | 전 세계 사용자에게 빠르고 안정된 콘텐츠 제공          |
| Chaos Engineering  | 장애 내성 확보       | 시스템의 복원성과 안정성 검증                   |
| 마이크로아키텍처 최적화       | CPU/메모리 최적 활용  | 인스턴스 수 줄이고 비용 대비 효율 향상             |

Netflix는 단순히 성능을 높이는 것을 넘어서, **예상 불가능한 부하나 장애에도 체계적으로 대응할 수 있는 구조를 갖추는 데 집중**했고 이러한 전략들이 모여 업계 최고 수준의 고가용성 스트리밍 서비스를 실현하게 될 수 있었다.

---

> 추가적으로, Netflix 외에도 Uber, LinkedIn, AWS Lambda 등도 유사한 우회 전략과 비동기적 아키텍처를 채택하여 대규모 트래픽 대응을 수행하고 있습니다.

### Twitter

- Fan-out 우선순위 기반 타임라인 갱신: 유명인, 영향력 있는 계정 또는 자주 상호작용하는 계정의 트윗은 먼저 전파되도록 우선순위 처리하고, 나머지 일반 사용자의 타임라인 갱신은 지연시켜 전체 시스템 부하를 분산함
### Uber

- P99 레이턴시 모니터링을 통한 고속 응답 보장: 전체 요청 중 99%가 일정 응답 시간 이내에 처리되는지를 감시하고, SLA(서비스 수준 목표)를 초과하는 요청을 실시간 감지해 시스템 튜닝 또는 부하 조절을 통해 빠른 응답률을 유지함. 이때 부하 조절은 주로 다음과 같은 방식으로 수행됨:
  - 자동 스케일링(Auto-scaling): 서버 인스턴스를 수평으로 확장해 처리 여유 확보
  - Rate Limiting: 특정 사용자 그룹 또는 비핵심 요청을 초당 제한하여 자원 우선순위 확보
  - 큐 길이 기반 튜닝: 처리 큐의 길이에 따라 병렬 처리 수 조정
  - 캐시 강제화: 일시적으로 캐시 TTL을 연장하여 동일 요청 재처리 최소화
  - Graceful Degradation: 비필수 기능(예: 추천, 통계 등)을 일시적으로 중단 또는 지연

