
---

# 락(Lock)과 트랜잭션(Transaction)의 정의

### ✅ 락(Lock)

> 락은 동시에 여러 작업이 공유 자원에 접근할 때 **데이터의 무결성과 일관성**을 보장하기 위해 **접근을 제한하는 메커니즘**이다.
>
> 락은 스레드나 프로세스 간 \*\*경쟁 조건(Race Condition)\*\*을 방지하며, **일시적으로 자원을 점유하여 다른 작업의 간섭을 차단**한다.

* 예시: 스레드 A가 메모리 블록을 쓰는 중이면, 스레드 B는 해당 블록을 읽거나 쓸 수 없음.

---

### ✅ 트랜잭션(Transaction)

> 트랜잭션은 **하나의 논리적 작업 단위**이며, 이 작업은 **완전히 수행되거나 전혀 수행되지 않아야 한다**는 원자성(Atomicity)을 보장한다.
>
> 트랜잭션은 일반적으로 데이터베이스나 파일 시스템 등에서 사용되며, **ACID**(Atomicity, Consistency, Isolation, Durability) 원칙을 따른다.

* 예시: 은행 계좌 이체에서 A 계좌 출금과 B 계좌 입금은 하나의 트랜잭션으로 처리되어야 함.

---

🧬 왜 락과 트랜잭션은 따로 말할 수 없는가?

락과 트랜잭션은 서로 다른 개념이지만, 실무에서는 절대로 분리해서 생각할 수 없는 유기적인 관계다. 트랜잭션이 전체 작업의 성공/실패를 보장하는 논리적 경계라면, 락은 그 안에서 개별 자원의 상태를 보호하는 물리적 장치다.

트랜잭션은 ACID의 격리성과 일관성을 만족시키기 위해 락을 활용하며, 락은 반드시 트랜잭션의 컨텍스트 안에서 해제되어야 한다. 트랜잭션이 없이 락만 존재한다면, 에러나 장애 발생 시 롤백이 불가능하고 시스템은 쉽게 일관성을 잃는다. 반대로 락 없이 트랜잭션만 사용한다면, 다중 트랜잭션 간 충돌을 방지할 수 없어 무결성이 깨진다.

즉, 락은 트랜잭션이 안전하게 완료되도록 보조하고, 트랜잭션은 락을 명확한 경계 안에서 관리한다. 이 둘은 구조적으로 함께 동작해야만 경쟁 회피, 데이터 보호, 시스템 안정성이라는 세 가지 실무적 목표를 동시에 달성할 수 있다.

---

# "티켓팅 서비스" 속 락 과 트랜잭션의 연관성

### ✅ 예시 상황: 좌석 예매, 이벤트 티켓팅, 상품 재고 한정 판매

* 수천 명의 유저가 동시에 특정 리소스에 접근하려고 할 때,

  * **"내가 예약을 눌렀는데 대기 중"**
  * **"결제까지 갔는데 품절됨"**
  * 이런 상황은 대부분 **락과 트랜잭션 설계의 한계나 병목**과 관련된다.

---

### 🎯 시스템 설계자의 목표

| 목표       | 설명                                        |
| -------- | ----------------------------------------- |
| 동시성 제어   | 동시에 많은 사용자가 접근해도 시스템이 무결성을 유지해야 함         |
| 처리 속도 보장 | 락을 남용하면 처리 속도 저하. 락을 최소화하되 정확성 보장 필요      |
| 사용자 경험   | 락으로 인해 불필요한 대기 시간이 늘어나지 않도록 설계            |
| 무결성 보장   | 예매, 결제 등 중요한 작업은 트랜잭션으로 묶어 실패 시 복구 가능해야 함 |

---

###  연결 구조: 락 ↔ 트랜잭션 ↔ 대기

1. **사용자가 요청**

   * `/purchase` API에 동시에 요청이 몰림
2. **트랜잭션 시작**

   * DB에서 `START TRANSACTION`
   * 예: `SELECT ... FOR UPDATE` (락 획득)
3. **락이 걸림**

   * 동일 자원을 노리는 다른 트랜잭션은 **락 해제까지 대기**
4. **처리 및 커밋**

   * 재고 감소 → 결제 완료 → `COMMIT`
5. **락 해제 후 다음 요청 처리**

> 즉, 사용자가 기다리는 현상은 대부분 **트랜잭션 내부에서 락을 보유한 상태로 처리 중이기 때문**이며, 락을 효율적으로 다루지 못하면 **동시성 병목**이 발생하게 된다.

---

## 🔁 트랜잭션과 락의 연관성

| 항목                                  | 설명                               |
| ----------------------------------- | -------------------------------- |
| 락은 트랜잭션의 **하위 메커니즘**이다              | 트랜잭션은 내부에서 공유 자원을 보호하기 위해 락을 사용함 |
| 트랜잭션은 ACID를 보장                      | 이를 위해 상태를 보호할 **락**이 필요          |
| 락 없이는 트랜잭션이 격리성(Isolation)을 보장하지 못함 | 동시 처리 중 데이터가 꼬일 수 있음             |
| 락만 있고 트랜잭션이 없으면?                    | 시스템은 일관성을 유지할 수 없고 복구도 불가능함      |

---

## 결론 정리

* 락은 **자원 단위의 접근 제어 메커니즘**, 트랜잭션은 **작업 단위의 원자적 실행 단위**이다.
* 트랜잭션이 락을 통해 **데이터 무결성**, **상태 일관성**, **경쟁 회피**를 보장한다.
* 우리가 흔히 마주치는 "대기", "중복 결제", "이중 처리" 문제는 대부분 이 **트랜잭션-락 구조의 설계 미비**에서 발생한다.
* **트랜잭션을 사용하는 이유는 단순히 데이터 묶음 때문이 아니라, 락을 안전하게 관리하기 위해서**다.
* 락을 효율적으로 설계하지 않으면, 시스템은 느려지고, 트랜잭션은 쌓이고, 결국 장애가 발생한다.

---
